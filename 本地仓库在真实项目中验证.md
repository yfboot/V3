# 在真实项目中用本地仓库安装并验证

把 **packages**（及可选 **manual_packages**）和 **local_registry.py** 拷到真实项目后，从本地 registry 安装依赖并验证项目能否跑起来。

## 1. 复制到真实项目

在真实项目根目录下准备：

- **packages/**：从 V3 拷过来的、装有 .tgz 的目录（可再包含 **manual_packages/**）。
- **local_registry.py**：从 V3 拷到项目根（与 package.json 同级）。

目录结构示例：

```
你的项目/
├── package.json
├── package-lock.json    # 可选
├── local_registry.py   # 从 V3 复制
├── packages/           # 从 V3 复制，内含 .tgz
├── manual_packages/    # 可选，从 V3 复制
└── ...
```

## 2. 启动本地 registry（单独运行）

在项目根目录打开终端，执行：

```bash
python local_registry.py 4874
```

默认会同时扫描 `packages/` + `manual_packages/`（若某个目录不存在会自动跳过）。

若你想只扫描 `packages`（不读 manual_packages），可以显式指定目录：

```bash
python local_registry.py packages 4874
```

看到类似 “本地 registry 已启动: http://127.0.0.1:4874” 即表示成功。**保持该终端不关闭**。

## 3. 安装依赖

再开一个终端，仍在项目根执行：

```bash
npm install --registry http://127.0.0.1:4874
```

若有 lock 且希望完全按本地包解析，可先临时改名再装：

```bash
move package-lock.json package-lock.json.bak
npm install --registry http://127.0.0.1:4874
```

## 4. 验证依赖是否完整、项目能否跑起来

- 安装无报错、`node_modules` 完整 → 依赖从本地仓库安装成功。
- 按项目原有方式启动（如 `npm run dev` / `npm start`），能正常跑起来 → 说明依赖完整、可正常使用。

若安装时报 404/缺包，说明该包不在当前 packages（或 manual_packages）里，需要回到 V3 用 flow 补包后再把新的 .tgz 拷进项目的 packages/manual_packages，重启 local_registry 再执行一次 `npm install --registry http://127.0.0.1:4874`。

## 5. 关闭本地 registry

验证结束后，在运行 `local_registry.py` 的那个终端按 **Ctrl+C** 停止服务。
